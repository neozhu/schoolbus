@page "/mobile/triponmap/{RouteId:int}"
@using GoogleMapsComponents
@using GoogleMapsComponents.Maps
@using Size= MudBlazor.Size
@inject NavigationManager NavigationManager
@implements IAsyncDisposable
<PageTitle>General information</PageTitle>

<MudPaper Elevation="0" Class="d-flex flex-column justify-space-between flex-grow-1 pa-4 mt-10 gap-4">
    <div class="d-flex flex-row justify-space-between align-center gap-1">
        <div class="d-flex flex-column justify-space-between my-2  gap-1">
            <MudText Typo="Typo.h6">General information</MudText>
            <div class="d-flex flex-row align-center   gap-1">
                <MudIcon Icon="@Icons.Material.Filled.DirectionsBus" Title="bus no." />
                <MudText Typo="Typo.body2">School bus #1 - 69-929L </MudText>
            </div>
            <div class="d-flex flex-row align-center   gap-1">
                <MudIcon Icon="@Icons.Material.Filled.AccountCircle" Title="driver" />
                <MudText Typo="Typo.body2">Driver: John Anderson </MudText>
            </div>
        </div>
        <div class="d-flex flex-column">
            <MudText Typo="Typo.h3">09:41:17 AM</MudText>
            <div class="d-flex flex-row align-center   gap-1 ">
                <MudIcon Icon="@Icons.Material.Filled.CalendarMonth" Title="date" />
                <MudText Typo="Typo.body2">Monday. June 6 </MudText>
            </div>
        </div>
    </div>
    <div class="d-flex flex-column">
        <MudText Typo="Typo.h6">Route information</MudText>
        <div class="d-flex flex-row justify-space-between align-center   gap-2">
            <MudTextField @bind-Value="start" Label="start location" Variant="Variant.Outlined"></MudTextField>
            <MudIcon Size="Size.Large" Icon="@Icons.Material.Filled.Route" Title="route" />
            <MudTextField @bind-Value="final" Label="final location" Variant="Variant.Outlined"></MudTextField>
        </div>
    </div>
    <div class="d-flex flex-row justify-space-between align-center gap-2">
        <div class="d-flex flex-column my-2 gap-1">
            <MudText Typo="Typo.h6">Total passengers on board</MudText>
            <MudTextField @bind-Value="search" Label="Search" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Search" AdornmentColor="Color.Secondary" />
        </div>
        <MudPaper Elevation="0" Class="pa-3" Style="height:80px; width:160px;">
            <div class="d-lg-block mud-theme-tertiary rounded px-4" style="height:100%; width:100%;"><MudText Typo="Typo.h3">20</MudText></div>
        </MudPaper>
    </div>
    <div class="mapcontainer pa-0">
        <GoogleMap @ref="@_map1" Id="map1" Options="@_mapOptions" Height="650px" OnAfterInit="@(async () => await OnAfterInitAsync())"></GoogleMap>
    </div>
</MudPaper>
@code {
    [Parameter]
    public int RouteId { get; set; }
    private string start { get; set; } = "2285 South Federal Blvd";
    private string final { get; set; } = "2160 S Cook Street";
    private string search { get; set; }
    private GoogleMap? _map1;
    private MapOptions _mapOptions;
    private DirectionsRenderer _dirRend;
    protected override void OnInitialized()
    {
        _mapOptions = new MapOptions()
            {
                Zoom = 13,
                Center = new LatLngLiteral()
                {
                    Lat = 40.603629,
                    Lng = -75.472518
                },
                MapTypeId = MapTypeId.Roadmap
            };
    }
    private async Task OnAfterInitAsync()
    {
        //Create instance of DirectionRenderer
        _dirRend = await DirectionsRenderer.CreateAsync(_map1.JsRuntime, new DirectionsRendererOptions()
            {
                Map = _map1.InteropObject
            });
    }
    public async ValueTask DisposeAsync()
    {
        if (_dirRend is not null)
        {
            await _dirRend.SetMap(null);
            _dirRend.Dispose();
        }
    }
}
